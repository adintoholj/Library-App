<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
  xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
  xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
  xmlns:controls="clr-namespace:BibliothequariaFrontend.Controls"
  x:Class="BibliothequariaFrontend.Pages.MemberOperationsPage"
  BackgroundColor="{DynamicResource ContentBackground}"
  Shell.NavBarIsVisible="False"
  Padding="0">

    <Grid ColumnDefinitions="373, *">

        <!-- NAV BAR -->
        <Grid
      Grid.Column="0"
      BackgroundColor="#FDBF1D"
      RowDefinitions="100,*,60"
      Padding="20">

            <!-- Row 0: Logo -->
            <Image
        Grid.Row="0"
        Source="bibliothequarialogo.png"
        HeightRequest="80"
        HorizontalOptions="Start"
        VerticalOptions="Center" />

            <!-- Row 1: Main nav items -->
            <StackLayout
        Grid.Row="1"
        Spacing="40"
        Padding="10,20,0,0">

                <!-- Dashboard (tappable) -->
                <StackLayout
  Orientation="Horizontal"
  Spacing="15"
  VerticalOptions="Center"
                    Margin="0,20,10,-15">
                    <StackLayout.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnDashboardTapped" />
                    </StackLayout.GestureRecognizers>

                    <Image Source="dashboard.png" HeightRequest="24" WidthRequest="24" />
                    <Label
    Text="Dashboard"
    FontFamily="PoppinsBold"
    FontSize="18"
    TextColor="Black"
    VerticalOptions="Center" />
                </StackLayout>


                <!-- Member operations (selected) -->
                <Frame
          BackgroundColor="#3A3428"
          CornerRadius="8"
          Padding="10"
          HasShadow="False"
          HorizontalOptions="Fill"
          Margin="-10,10,10,-10">
                    <StackLayout Orientation="Horizontal" Spacing="15" VerticalOptions="Center">
                        <Image Source="memberoperations.png" HeightRequest="24" WidthRequest="24" />
                        <Label
              Text="Member operations"
              FontFamily="PoppinsBold"
              FontSize="18"
              TextColor="White"
              VerticalOptions="Center" />
                    </StackLayout>
                </Frame>

                <!-- Book operations -->
                <StackLayout Orientation="Horizontal" Spacing="15" VerticalOptions="Center">
                    <StackLayout.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnBookOperationsTapped" />
                    </StackLayout.GestureRecognizers>
                    <Image Source="bookoperations.png" HeightRequest="24" WidthRequest="24" />
                    <Label
            Text="Book operations"
            FontFamily="PoppinsBold"
            FontSize="18"
            TextColor="Black"
            VerticalOptions="Center" />
                </StackLayout>

                <!-- Search (tappable) -->
                <StackLayout
  Orientation="Horizontal"
  Spacing="15"
  VerticalOptions="Center">
                    <StackLayout.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnSearchTapped" />
                    </StackLayout.GestureRecognizers>
                    <Image
    Source="searchoperations.png"
    HeightRequest="24"
    WidthRequest="24" />
                    <Label
    Text="Search"
    FontFamily="PoppinsBold"
    FontSize="18"
    TextColor="Black"
    VerticalOptions="Center" />
                </StackLayout>


            </StackLayout>

            <!-- Row 2: Settings (tappable) -->
            <StackLayout
  Grid.Row="2"
  Orientation="Horizontal"
  Spacing="15"
  VerticalOptions="Center"
  Padding="10,0,0,0">
                <StackLayout.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnSettingsTapped" />
                </StackLayout.GestureRecognizers>
                <Image Source="settings.png" HeightRequest="24" WidthRequest="24" />
                <Label
    Text="Settings"
    FontFamily="PoppinsBold"
    FontSize="18"
    TextColor="Black"
    VerticalOptions="Center" />
            </StackLayout>


        </Grid>

        <!-- MAIN CONTENT -->
        <Grid
      Grid.Column="1"
      RowDefinitions="Auto,*,Auto"
      Padding="30">

            <!-- Header -->
            <Grid Grid.Row="0" ColumnDefinitions="*,Auto">
                <StackLayout Spacing="5">
                    <Label
            Text="Member operations"
            FontFamily="PoppinsBold"
            FontSize="24"
            TextColor="{DynamicResource ContentTextColor}" />
                    <Label
            Text="In here, you can add new users or change the status of an existing user"
            FontFamily="PoppinsRegular"
            FontSize="16"
            TextColor="{DynamicResource ContentTextColor}"
            LineBreakMode="WordWrap" />
                </StackLayout>

                <!-- Profile pic -->
                <Image
    Source="pfp.png"
    HeightRequest="50"
    WidthRequest="50"
    HorizontalOptions="End"
    VerticalOptions="Center">
                    <Image.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnAvatarTapped" />
                    </Image.GestureRecognizers>
                </Image>

            </Grid>

            <!-- Table container -->
            <Frame Grid.Row="1"
       BackgroundColor="#DBCC99"
       CornerRadius="8"
       Padding="10"
       HasShadow="False">

                <ScrollView>
                    <Grid RowDefinitions="Auto,Auto" ColumnDefinitions="*">

                        <!-- Header row (unchanged) -->
                        <Grid Grid.Row="0" ColumnDefinitions="2*,*,*,*" ColumnSpacing="5" Padding="0,0,10,8">
                            <Label Grid.Column="0" Text="Name &amp; Surname" FontFamily="PoppinsBold" FontSize="14" TextColor="Black" Margin="70,0,0,0"/>
                            <Label Grid.Column="1" Text="Date added"        FontFamily="PoppinsBold" FontSize="14" TextColor="Black"/>
                            <Label Grid.Column="2" Text="Date of expiry"    FontFamily="PoppinsBold" FontSize="14" TextColor="Black"/>
                            <Label Grid.Column="3" Text="Currently borrowed books" FontFamily="PoppinsBold" FontSize="14" TextColor="Black"/>
                        </Grid>

                        <!-- Live rows -->
                        <CollectionView Grid.Row="1"
                      ItemsSource="{Binding Members}"
                      SelectionMode="None"
                      Margin="0,6,0,0">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Grid ColumnDefinitions="2*,*,*,*" ColumnSpacing="5" Padding="0,10">
                                        <!-- Column 0: icon + full name -->
                                        <Grid Grid.Column="0" ColumnDefinitions="Auto,*" ColumnSpacing="10">
                                            <Image Source="littlemember.png" HeightRequest="20" WidthRequest="20" VerticalOptions="Center" Margin="190,0,0,0"/>
                                            <Label Text="{Binding FullName}"
                       FontFamily="PoppinsRegular"
                       FontSize="14"
                       TextColor="Black"
                       VerticalOptions="Center"/>
                                        </Grid>

                                        <!-- Column 1: Date added -->
                                        <Label Grid.Column="1"
                     Text="{Binding DatumUclaneDisplay}"
                     FontFamily="PoppinsRegular"
                     FontSize="14"
                     TextColor="Black"
                     VerticalOptions="Center"/>

                                        <!-- Column 2: Date of expiry -->
                                        <Label Grid.Column="2"
                     Text="{Binding DatumIstekaDisplay}"
                     FontFamily="PoppinsRegular"
                     FontSize="14"
                     TextColor="Black"
                     VerticalOptions="Center"/>

                                        <!-- Column 3: Borrowed count -->
                                        <Label Grid.Column="3"
                     Text="{Binding BorrowedCount}"
                     FontFamily="PoppinsRegular"
                     FontSize="14"
                     TextColor="Black"
                     VerticalOptions="Center"/>
                                    </Grid>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>

                    </Grid>
                </ScrollView>
            </Frame>


            <!-- Bottom buttons -->
            <StackLayout
        Grid.Row="2"
        Orientation="Horizontal"
        Spacing="20"
        HorizontalOptions="Center"
        Padding="0,10,0,0">
                <controls:GrayButtonControl
          Text="View loan history"
          Command="{Binding SeeInChargeCommand}" />
                <controls:GrayButtonControl
          Text="Change member status"
          Command="{Binding ChangeStatusCommand}" />
                <controls:GrayButtonControl
                    Text="Add member"
          Command="{Binding AddUserCommand}" />
            </StackLayout>

        </Grid>
    </Grid>
    
</ContentPage>
